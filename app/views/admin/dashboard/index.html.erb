<h1 class="text-3xl font-semibold mb-6">🛠 Admin Dashboard</h1>

<!-- Filter Form -->
<div class="bg-white rounded shadow p-4 mb-6">
  <h2 class="text-xl font-medium mb-3">🔍 Filter Meetings</h2>
  <%= form_with url: admin_meetings_path, method: :get, local: true, class: 'space-y-4 grid md:grid-cols-4 gap-4' do |f| %>
    <div>
      <%= f.label :status, 'Status', class: 'block text-sm font-medium' %>
      <%= f.select :status, options_for_select([['All', ''], ['Scheduled', 'scheduled'], ['Canceled', 'canceled'], ['Completed', 'completed']], params[:status]), {}, class: 'w-full border rounded p-2' %>
    </div>
    <div>
      <%= f.label :user_id, 'User', class: 'block text-sm font-medium' %>
      <%= f.select :user_id, options_for_select(User.all.map { |u| [u.email, u.id] }, params[:user_id]), { include_blank: 'All' }, class: 'w-full border rounded p-2' %>
    </div>
    <div>
      <%= f.label :start_date, 'Start Date', class: 'block text-sm font-medium' %>
      <%= f.date_field :start_date, value: params[:start_date], class: 'w-full border rounded p-2' %>
    </div>
    <div class="flex items-end">
      <%= f.submit 'Filter', class: 'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow w-full' %>
    </div>
  <% end %>
</div>

<!-- Meetings Table -->
<div class="bg-white rounded shadow p-4 mb-6 overflow-auto">
  <h2 class="text-xl font-medium mb-3">📋 All Meetings</h2>
  <table class="min-w-full text-sm text-left border">
    <thead class="bg-gray-100">
      <tr>
        <th class="p-3 border">User</th>
        <th class="p-3 border">Start Time</th>
        <th class="p-3 border">Duration</th>
        <th class="p-3 border">Status</th>
        <th class="p-3 border">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @meetings.each do |meeting| %>
        <tr class="hover:bg-gray-50">
          <td class="p-3 border"><%= meeting.user.email %></td>
          <td class="p-3 border"><%= meeting.start_time.strftime('%Y-%m-%d %H:%M') %></td>
          <td class="p-3 border"><%= meeting.duration %> min</td>
          <td class="p-3 border capitalize"><%= meeting.status %></td>
          <td class="p-3 border">
            <%= link_to 'Cancel', admin_meeting_path(meeting), method: :delete, data: { confirm: 'Are you sure?' }, class: 'text-red-600 hover:underline' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<!-- Calendar -->
<div class="bg-white rounded shadow p-4">
  <h2 class="text-xl font-medium mb-4">🗓 Meeting Calendar</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
    <%= month_calendar(events: @meetings, attribute: :start_time) do |date, meetings| %>
      <div class="border rounded p-3 bg-gray-50 shadow hover:shadow-md transition">
        <div class="font-semibold mb-2"><%= date.strftime('%b %d, %Y') %></div>
        <% meetings.each do |meeting| %>
          <div class="text-sm text-blue-700 mb-1">
            <%= meeting.start_time.strftime('%H:%M') %> – <%= meeting.user.email %> (<%= meeting.status %>)
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
